<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CRTV Sizing Calculator</title>

<style>
  :root{
    --bg:#191919;
    --panel:#191919;
    --stroke:rgba(255,255,255,.10);
    --stroke2:rgba(255,255,255,.08);

    --text:rgba(255,255,255,.92);
    --muted:rgba(255,255,255,.60);

    --good:#28E6A5;
    --warn:#FFD34D;
    --bad:#FF4D6D;

    --glass:rgba(0,0,0,.20);
    --glass2:rgba(255,255,255,.04);

    --radius:18px;
    --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    --sans: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; margin:0; background:var(--bg); }
  body{
    font-family:var(--sans);
    color:var(--text);
    padding:10px;
  }

  /* prevent iOS zoom quirks */
  input, button{ font-size:16px; }

  .wrap{ width:100%; max-width:560px; margin:0 auto; }

  .panel{
    background:var(--panel);
    border:1px solid var(--stroke2);
    border-radius:var(--radius);
    overflow:hidden;
  }

  .top{
    padding:12px 12px 10px;
    border-bottom:1px solid rgba(255,255,255,.07);
  }

  .titleRow{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:10px;
  }

  .title{
    font-size:16px;
    font-weight:850;
    letter-spacing:.2px;
  }

  .formula{
    margin-top:6px;
    font-family:var(--mono);
    color:rgba(255,255,255,.65);
    font-size:12px;
    line-height:1.35;
  }

  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    font-family:var(--mono);
    font-size:12px;
    white-space:nowrap;
  }

  .dot{
    width:10px;height:10px;border-radius:50%;
    box-shadow:0 0 0 4px rgba(255,255,255,.06);
    flex:0 0 auto;
  }

  .content{ padding:12px; }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
  }

  /* phone = one column so nothing cuts */
  @media (max-width: 420px){
    .wrap{ max-width: 420px; }
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.14);
    border-radius:16px;
    padding:12px;
    min-width:0;
  }

  .label{
    font-family:var(--mono);
    font-size:12px;
    color:rgba(255,255,255,.70);
    letter-spacing:.2px;
    margin-bottom:8px;
  }

  .input{
    width:100%;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.20);
    color:rgba(255,255,255,.92);
    padding:12px 12px;
    outline:none;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
  }
  .input::placeholder{ color:rgba(255,255,255,.35); }

  .chips{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:10px;
  }

  .chipBtn{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.80);
    font-family:var(--mono);
    cursor:pointer;
    transition:transform 160ms ease, box-shadow 160ms ease;
  }
  .chipBtn:active{ transform:scale(.97); }

  /* Apple-glass button */
  .btn{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    color:rgba(255,255,255,.86);
    font-family:var(--mono);
    cursor:pointer;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* ---- Custom dropdown (animated reveal) ---- */
  .selectWrap{
    position:relative;
  }
  .selectBtn{
    width:100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    color:rgba(255,255,255,.92);
    cursor:pointer;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  .selectLeft{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }
  .selectText{
    font-family:var(--mono);
    font-size:14px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .chev{
    width:10px;height:10px;
    border-right:2px solid rgba(255,255,255,.70);
    border-bottom:2px solid rgba(255,255,255,.70);
    transform:rotate(45deg);
    transition:transform 180ms ease;
  }

  .menu{
    position:absolute;
    left:0; right:0;
    top: calc(100% + 8px);
    border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.35);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    overflow:hidden;
    transform-origin: top;
    transform: scaleY(.92);
    opacity:0;
    pointer-events:none;
    transition: opacity 160ms ease, transform 180ms ease;
    z-index:50;
  }
  .menu.open{
    opacity:1;
    transform: scaleY(1);
    pointer-events:auto;
  }
  .menuItem{
    padding:12px 12px;
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
    border-top:1px solid rgba(255,255,255,.06);
  }
  .menuItem:first-child{ border-top:none; }
  .menuItem:hover{ background:rgba(255,255,255,.05); }

  /* outputs */
  .outGrid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
    margin-top:10px;
  }
  @media (max-width: 420px){
    .outGrid{ grid-template-columns: 1fr; }
  }

  .out{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.12);
    border-radius:16px;
    padding:12px;
    min-width:0;
  }
  .outTitle{
    font-family:var(--mono);
    color:rgba(255,255,255,.70);
    font-size:12px;
    margin-bottom:6px;
  }
  .outVal{
    font-family:var(--mono);
    font-size:24px;
    letter-spacing:.3px;
  }

  .miniChips{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:10px;
  }
  .miniChip{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.80);
    font-family:var(--mono);
    font-size:12px;
  }

  .status{
    margin-top:10px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.14);
    border-radius:16px;
    padding:12px;
    display:flex;
    align-items:center;
    gap:10px;
    font-family:var(--mono);
    color:rgba(255,255,255,.86);
  }
  .statusDot{
    width:12px;height:12px;border-radius:50%;
    box-shadow:0 0 0 5px rgba(255,255,255,.06);
    flex:0 0 auto;
  }

  .bottomRow{
    display:flex;
    justify-content:flex-end;
    padding:10px 12px 12px;
    border-top:1px solid rgba(255,255,255,.07);
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">

    <div class="top">
      <div class="titleRow">
        <div>
          <div class="title">Position Size</div>
          <div class="formula" id="formulaText"></div>
        </div>

        <div class="pill" id="symbolPill">
          <span class="dot" id="pillDot"></span>
          <span id="pillText"></span>
        </div>
      </div>
    </div>

    <div class="content">

      <div class="grid">

        <div class="card">
          <div class="label">SYMBOL</div>

          <div class="selectWrap">
            <button class="selectBtn" id="selectBtn" type="button">
              <div class="selectLeft">
                <span class="dot" id="selectDot"></span>
                <span class="selectText" id="selectText">MNQ</span>
              </div>
              <div class="chev" id="selectChev"></div>
            </button>

            <div class="menu" id="menu">
              <div class="menuItem" data-sym="MNQ">
                <span class="dot" style="background:#28E6A5"></span>
                <span class="selectText">MNQ • $2/pt</span>
              </div>
              <div class="menuItem" data-sym="MES">
                <span class="dot" style="background:#28E6A5"></span>
                <span class="selectText">MES • $5/pt</span>
              </div>
              <div class="menuItem" data-sym="MGC1">
                <span class="dot" style="background:#FFD34D"></span>
                <span class="selectText">MGC1! • $10/1.0</span>
              </div>
              <div class="menuItem" data-sym="SI1">
                <span class="dot" style="background:#FF4D6D"></span>
                <span class="selectText">SI1! • $5 per 0.01</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="riskCard">
          <div class="label" id="riskLabel">$ RISK (PER TRADE)</div>
          <input class="input" id="riskInput" inputmode="decimal" placeholder="e.g. 100" />
          <div class="chips" id="riskChips">
            <button class="chipBtn" type="button" data-risk="50">50</button>
            <button class="chipBtn" type="button" data-risk="80">80</button>
            <button class="chipBtn" type="button" data-risk="100">100</button>
            <button class="chipBtn" type="button" data-risk="120">120</button>
          </div>
        </div>

        <div class="card">
          <div class="label" id="stopLabel">STOP</div>
          <input class="input" id="stopInput" inputmode="decimal" placeholder="Enter stop" />
          <div class="chips" id="stopChips"></div>
        </div>

        <div class="card">
          <div class="label" id="tpLabel">TP</div>
          <input class="input" id="tpInput" inputmode="decimal" placeholder="Enter TP" />
          <div class="chips" id="tpChips"></div>
        </div>

      </div>

      <div class="outGrid">
        <div class="out">
          <div class="outTitle">CONTRACTS</div>
          <div class="outVal" id="outContracts">—</div>
        </div>
        <div class="out">
          <div class="outTitle">TOTAL RISK ($)</div>
          <div class="outVal" id="outRisk">$—</div>
        </div>
        <div class="out">
          <div class="outTitle">TP PROFIT ($)</div>
          <div class="outVal" id="outProfit">$—</div>
        </div>
        <div class="out">
          <div class="outTitle" id="unitTitle">$ / POINT</div>
          <div class="outVal" id="outUnit">$—</div>
        </div>
      </div>

      <div class="miniChips" id="recChips"></div>

      <div class="status" id="statusBox">
        <span class="statusDot" id="statusDot" style="background:var(--warn)"></span>
        <span id="statusText">Enter values to calculate.</span>
      </div>

    </div>

    <div class="bottomRow">
      <button class="btn" id="resetBtn" type="button">Reset Inputs</button>
    </div>

  </div>
</div>

<script>
  // =========================
  // CONFIG
  // =========================
  const SYMBOLS = {
    MNQ: {
      name: "MNQ",
      pill: "MNQ • $2/pt",
      color: "#28E6A5",
      mode: "normal",
      unitTitle: "$ / POINT (1 MICRO)",
      unitValue: 2,
      stopChips: [20,25,30,40],
      tpChips: [60,80,100],
      rec: ["Challenge: 1–3", "Funded: 1–5", "Abs max: 40 (never)"],
      formula: "Size = Risk ÷ (Stop × $/Point)"
    },
    MES: {
      name: "MES",
      pill: "MES • $5/pt",
      color: "#28E6A5",
      mode: "normal",
      unitTitle: "$ / POINT (1 MICRO)",
      unitValue: 5,
      stopChips: [5,8,10],
      tpChips: [10,12,20],
      rec: ["Challenge: 1–2", "Funded: 1–4"],
      formula: "Size = Risk ÷ (Stop × $/Point)"
    },
    MGC1: {
      name: "MGC1!",
      pill: "MGC1! • $10/1.0",
      color: "#FFD34D",
      mode: "normal",
      unitTitle: "$ / 1.0 (1 MICRO)",
      unitValue: 10,
      stopChips: [1,1.5,2,2.5],
      tpChips: [3,4,5,6],
      rec: ["Challenge: 1–2", "Funded: 1–3"],
      formula: "Size = Risk ÷ (Stop × $/Point)"
    },
    SI1: {
      name: "SI1!",
      pill: "SI1! • $5 per 0.01",
      color: "#FF4D6D",
      mode: "silver",
      // micro silver: $5 per 0.01
      per001: 5,
      step: 0.01,
      unitTitle: "$ PER 0.01 (1 MICRO)",
      stopChips: [0.02,0.03,0.04,0.05],
      tpChips: [0.06,0.10,0.12],
      rec: ["Challenge: avoid", "Funded: 1 micro ONLY", "Daily silver loss: $50 max"],
      formula: "Risk = (Stop ÷ 0.01) × $5 • Contracts = 1"
    }
  };

  const TZ = "America/Toronto"; // (for your journal context, not needed for math)

  // =========================
  // ELEMENTS
  // =========================
  const formulaText = document.getElementById("formulaText");

  const pillDot = document.getElementById("pillDot");
  const pillText = document.getElementById("pillText");

  const selectBtn = document.getElementById("selectBtn");
  const selectDot = document.getElementById("selectDot");
  const selectText = document.getElementById("selectText");
  const selectChev = document.getElementById("selectChev");
  const menu = document.getElementById("menu");

  const riskCard = document.getElementById("riskCard");
  const riskLabel = document.getElementById("riskLabel");
  const riskInput = document.getElementById("riskInput");
  const riskChips = document.getElementById("riskChips");

  const stopLabel = document.getElementById("stopLabel");
  const stopInput = document.getElementById("stopInput");
  const stopChips = document.getElementById("stopChips");

  const tpLabel = document.getElementById("tpLabel");
  const tpInput = document.getElementById("tpInput");
  const tpChips = document.getElementById("tpChips");

  const outContracts = document.getElementById("outContracts");
  const outRisk = document.getElementById("outRisk");
  const outProfit = document.getElementById("outProfit");
  const outUnit = document.getElementById("outUnit");
  const unitTitle = document.getElementById("unitTitle");

  const recChips = document.getElementById("recChips");

  const statusBox = document.getElementById("statusBox");
  const statusDot = document.getElementById("statusDot");
  const statusText = document.getElementById("statusText");

  const resetBtn = document.getElementById("resetBtn");

  // =========================
  // STATE
  // =========================
  let current = "MNQ";

  // =========================
  // HELPERS
  // =========================
  function toNum(v){
    if(v === "" || v == null) return NaN;
    const n = Number(String(v).replace(/,/g,"").trim());
    return Number.isFinite(n) ? n : NaN;
  }

  function money(n){
    if(!Number.isFinite(n)) return "—";
    const fixed = Math.round(n * 100) / 100;
    return fixed.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 2 });
  }

  function setStatus(type, msg){
    if(type === "good"){ statusDot.style.background = "var(--good)"; }
    else if(type === "bad"){ statusDot.style.background = "var(--bad)"; }
    else { statusDot.style.background = "var(--warn)"; }
    statusText.textContent = msg;
  }

  function clearChips(el){ el.innerHTML = ""; }
  function addChip(el, label, onClick){
    const b = document.createElement("button");
    b.type = "button";
    b.className = "chipBtn";
    b.textContent = label;
    b.addEventListener("click", onClick);
    el.appendChild(b);
  }

  function closeMenu(){
    menu.classList.remove("open");
    selectChev.style.transform = "rotate(45deg)";
  }

  // =========================
  // UI UPDATE
  // =========================
  function applySymbol(sym){
    current = sym;
    const S = SYMBOLS[current];

    // pill
    pillDot.style.background = S.color;
    selectDot.style.background = S.color;
    pillText.textContent = S.pill;
    selectText.textContent = S.name;

    // formula
    formulaText.textContent = S.formula;

    // unit title/value
    unitTitle.textContent = S.unitTitle;
    if(S.mode === "silver"){
      outUnit.textContent = `$${money(S.per001)}`;
    }else{
      outUnit.textContent = `$${money(S.unitValue)}`;
    }

    // risk behavior
    if(S.mode === "silver"){
      // disable risk input (silver uses stop to compute risk)
      riskCard.style.opacity = "0.55";
      riskInput.disabled = true;
      riskInput.value = "";
      riskLabel.textContent = "RISK (AUTO FROM STOP)";
      riskChips.style.display = "none";

      stopLabel.textContent = "STOP (DISTANCE)";
      tpLabel.textContent = "TP (DISTANCE)";
      stopInput.placeholder = "e.g. 0.04";
      tpInput.placeholder = "e.g. 0.12";
    }else{
      riskCard.style.opacity = "1";
      riskInput.disabled = false;
      riskLabel.textContent = "$ RISK (PER TRADE)";
      riskChips.style.display = "flex";

      stopLabel.textContent = "STOP";
      tpLabel.textContent = "TP";
      stopInput.placeholder = "Enter stop";
      tpInput.placeholder = "Enter TP";
    }

    // chips
    clearChips(stopChips);
    clearChips(tpChips);

    S.stopChips.forEach(v=>{
      addChip(stopChips, String(v), () => { stopInput.value = String(v); calc(); });
    });
    S.tpChips.forEach(v=>{
      addChip(tpChips, String(v), () => { tpInput.value = String(v); calc(); });
    });

    // recommendations
    recChips.innerHTML = "";
    S.rec.forEach(t=>{
      const d = document.createElement("div");
      d.className = "miniChip";
      d.textContent = t;
      recChips.appendChild(d);
    });

    // clean outputs
    outContracts.textContent = "—";
    outRisk.textContent = "$—";
    outProfit.textContent = "$—";

    setStatus("warn","Enter values to calculate.");
    closeMenu();
    calc();
  }

  // =========================
  // CALCULATION
  // =========================
  function calc(){
    const S = SYMBOLS[current];
    const stop = toNum(stopInput.value);
    const tp = toNum(tpInput.value);

    // For normal symbols
    if(S.mode !== "silver"){
      const risk = toNum(riskInput.value);

      if(!Number.isFinite(risk) || !Number.isFinite(stop) || stop <= 0){
        outContracts.textContent = "—";
        outRisk.textContent = "$—";
        outProfit.textContent = "$—";
        setStatus("warn","Enter Risk + Stop (and TP if you want profit).");
        return;
      }

      const perPoint = S.unitValue;
      let contracts = Math.floor(risk / (stop * perPoint));
      if(!Number.isFinite(contracts) || contracts < 0) contracts = 0;

      // cap by Lucid max 40 micros (you’re using micros)
      if(contracts > 40) contracts = 40;

      const totalRisk = contracts * stop * perPoint;
      const profit = (Number.isFinite(tp) && tp > 0) ? (tp * perPoint * contracts) : 0;

      outContracts.textContent = String(contracts);
      outRisk.textContent = `$${money(totalRisk)}`;
      outProfit.textContent = `$${money(profit)}`;

      // status rules
      if(contracts === 0){
        setStatus("bad","Size is 0. Increase risk or reduce stop.");
        return;
      }

      // warn if risk outside your rule (50–120)
      if(risk < 50 || risk > 120){
        setStatus("warn","Risk should be 50–120.");
      }else{
        setStatus("good","Sizing OK. Stop decides size.");
      }

      return;
    }

    // SILVER (SI1!) — fixed 1 micro
    // Risk = (Stop ÷ 0.01) × $5
    // Profit = (TP ÷ 0.01) × $5
    const contracts = 1;
    const per001 = S.per001;
    const step = S.step;

    if(!Number.isFinite(stop) || stop <= 0){
      outContracts.textContent = "1";
      outRisk.textContent = "$—";
      outProfit.textContent = "$—";
      setStatus("warn","Enter Stop distance (0.02–0.05).");
      return;
    }

    const totalRisk = (stop / step) * per001;
    const profit = (Number.isFinite(tp) && tp > 0) ? (tp / step) * per001 : 0;

    outContracts.textContent = "1";
    outRisk.textContent = `$${money(totalRisk)}`;
    outProfit.textContent = `$${money(profit)}`;

    // enforce your SI rules
    if(stop < 0.02 || stop > 0.05){
      setStatus("bad","Stop must be 0.02–0.05 (otherwise no trade).");
      return;
    }
    if(totalRisk > 50){
      setStatus("bad","Silver risk must be ≤ $50 (1 micro). Tighten stop.");
      return;
    }

    setStatus("good","Silver OK. 1 micro only. Risk controlled by stop.");
  }

  // =========================
  // EVENTS
  // =========================
  // dropdown open/close
  selectBtn.addEventListener("click", () => {
    const open = menu.classList.toggle("open");
    selectChev.style.transform = open ? "rotate(-135deg)" : "rotate(45deg)";
  });

  // click outside to close
  document.addEventListener("click", (e) => {
    if(!e.target.closest(".selectWrap")) closeMenu();
  });

  // select item
  menu.querySelectorAll(".menuItem").forEach(item=>{
    item.addEventListener("click", () => applySymbol(item.dataset.sym));
  });

  // risk chips
  riskChips.querySelectorAll("[data-risk]").forEach(b=>{
    b.addEventListener("click", () => {
      if(riskInput.disabled) return;
      riskInput.value = b.dataset.risk;
      calc();
    });
  });

  // inputs
  [riskInput, stopInput, tpInput].forEach(inp=>{
    inp.addEventListener("input", calc);
  });

  // reset
  resetBtn.addEventListener("click", () => {
    riskInput.value = "";
    stopInput.value = "";
    tpInput.value = "";
    calc();
  });

  // init
  applySymbol("MNQ");
</script>

</body>
</html>