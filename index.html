<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CRTV Sizing Calculator</title>

<style>
  :root{
    --bg:#191919;
    --panel:#191919;
    --stroke:rgba(255,255,255,.10);
    --stroke2:rgba(255,255,255,.08);

    --text:rgba(255,255,255,.92);
    --muted:rgba(255,255,255,.60);

    --good:#28E6A5;
    --warn:#FFD34D;
    --bad:#FF4D6D;

    --glass:rgba(0,0,0,.20);
    --glass2:rgba(255,255,255,.04);

    --radius:18px;
    --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    --sans: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; margin:0; background:var(--bg); }
  body{
    font-family:var(--sans);
    color:var(--text);
    padding:10px;
  }

  /* prevent iOS zoom quirks */
  input, button{ font-size:16px; }

  .wrap{ width:100%; max-width:560px; margin:0 auto; }

  .panel{
    background:var(--panel);
    border:1px solid var(--stroke2);
    border-radius:var(--radius);
    overflow:hidden;
  }

  .top{
    padding:12px 12px 10px;
    border-bottom:1px solid rgba(255,255,255,.07);
  }

  .titleRow{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:10px;
  }

  .title{
    font-size:16px;
    font-weight:850;
    letter-spacing:.2px;
  }

  .formula{
    margin-top:6px;
    font-family:var(--mono);
    color:rgba(255,255,255,.65);
    font-size:12px;
    line-height:1.35;
  }

  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    font-family:var(--mono);
    font-size:12px;
    white-space:nowrap;
  }

  .dot{
    width:10px;height:10px;border-radius:50%;
    box-shadow:0 0 0 4px rgba(255,255,255,.06);
    flex:0 0 auto;
  }

  .content{ padding:12px; }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
  }

  /* phone = one column so nothing cuts */
  @media (max-width: 420px){
    .wrap{ max-width: 420px; }
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.14);
    border-radius:16px;
    padding:12px;
    min-width:0;
  }

  .label{
    font-family:var(--mono);
    font-size:12px;
    color:rgba(255,255,255,.70);
    letter-spacing:.2px;
    margin-bottom:8px;
  }

  .input{
    width:100%;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.20);
    color:rgba(255,255,255,.92);
    padding:12px 12px;
    outline:none;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
  }
  .input::placeholder{ color:rgba(255,255,255,.35); }

  .chips{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:10px;
  }

  .chipBtn{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.80);
    font-family:var(--mono);
    cursor:pointer;
    transition:transform 160ms ease, box-shadow 160ms ease;
  }
  .chipBtn:active{ transform:scale(.97); }

  /* Apple-glass button */
  .btn{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    color:rgba(255,255,255,.86);
    font-family:var(--mono);
    cursor:pointer;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* ---- Custom dropdown (animated reveal) ---- */
  .selectWrap{ position:relative; }
  .selectBtn{
    width:100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    color:rgba(255,255,255,.92);
    cursor:pointer;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  .selectLeft{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }
  .selectText{
    font-family:var(--mono);
    font-size:14px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .chev{
    width:10px;height:10px;
    border-right:2px solid rgba(255,255,255,.70);
    border-bottom:2px solid rgba(255,255,255,.70);
    transform:rotate(45deg);
    transition:transform 180ms ease;
  }

  .menu{
    position:absolute;
    left:0; right:0;
    top: calc(100% + 8px);
    border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.35);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    overflow:hidden;
    transform-origin: top;
    transform: scaleY(.92);
    opacity:0;
    pointer-events:none;
    transition: opacity 160ms ease, transform 180ms ease;
    z-index:50;
  }
  .menu.open{
    opacity:1;
    transform: scaleY(1);
    pointer-events:auto;
  }
  .menuItem{
    padding:12px 12px;
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
    border-top:1px solid rgba(255,255,255,.06);
  }
  .menuItem:first-child{ border-top:none; }
  .menuItem:hover{ background:rgba(255,255,255,.05); }

  /* outputs */
  .outGrid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
    margin-top:10px;
  }
  @media (max-width: 420px){
    .outGrid{ grid-template-columns: 1fr; }
  }

  .out{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.12);
    border-radius:16px;
    padding:12px;
    min-width:0;
  }
  .outTitle{
    font-family:var(--mono);
    color:rgba(255,255,255,.70);
    font-size:12px;
    margin-bottom:6px;
  }
  .outVal{
    font-family:var(--mono);
    font-size:24px;
    letter-spacing:.3px;
  }

  .miniChips{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:10px;
  }
  .miniChip{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.80);
    font-family:var(--mono);
    font-size:12px;
  }

  .status{
    margin-top:10px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.14);
    border-radius:16px;
    padding:12px;
    display:flex;
    align-items:center;
    gap:10px;
    font-family:var(--mono);
    color:rgba(255,255,255,.86);
  }
  .statusDot{
    width:12px;height:12px;border-radius:50%;
    box-shadow:0 0 0 5px rgba(255,255,255,.06);
    flex:0 0 auto;
  }

  .bottomRow{
    display:flex;
    justify-content:flex-end;
    padding:10px 12px 12px;
    border-top:1px solid rgba(255,255,255,.07);
  }

  /* ===== Apple-glass toggle (SI1 only) ===== */
  .toggleRow{
    display:none; /* shown only for SI1 */
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.14);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .toggleText{
    font-family:var(--mono);
    font-size:12px;
    color:rgba(255,255,255,.80);
    white-space:nowrap;
  }
  .switch{
    position:relative;
    width:72px;
    height:40px;
    flex:0 0 auto;
  }
  .switch input{
    position:absolute;
    inset:0;
    opacity:0;
    cursor:pointer;
    margin:0;
  }
  .track{
    position:absolute;
    inset:0;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.08);
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,.06),
      0 12px 30px rgba(0,0,0,.35);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    transition: background 200ms ease, border-color 200ms ease;
  }
  .knob{
    position:absolute;
    top:6px; left:6px;
    width:28px; height:28px;
    border-radius:999px;
    background:rgba(255,255,255,.70);
    box-shadow:
      0 10px 18px rgba(0,0,0,.35),
      inset 0 0 0 1px rgba(255,255,255,.35);
    transition: transform 220ms cubic-bezier(.2,.8,.2,1);
    filter:saturate(1.05);
  }
  .switch input:checked ~ .track{
    background:rgba(120,180,255,.20);
    border-color:rgba(255,255,255,.22);
  }
  .switch input:checked ~ .knob{
    transform: translateX(32px);
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">

    <div class="top">
      <div class="titleRow">
        <div>
          <div class="title">Position Size</div>
          <div class="formula" id="formulaText"></div>
        </div>

        <div class="pill" id="symbolPill">
          <span class="dot" id="pillDot"></span>
          <span id="pillText"></span>
        </div>
      </div>
    </div>

    <div class="content">

      <div class="grid">

        <div class="card">
          <div class="label">SYMBOL</div>

          <div class="selectWrap">
            <button class="selectBtn" id="selectBtn" type="button">
              <div class="selectLeft">
                <span class="dot" id="selectDot"></span>
                <span class="selectText" id="selectText">MNQ</span>
              </div>
              <div class="chev" id="selectChev"></div>
            </button>

            <div class="menu" id="menu">
              <div class="menuItem" data-sym="MNQ">
                <span class="dot" style="background:#28E6A5"></span>
                <span class="selectText">MNQ • $2/pt</span>
              </div>
              <div class="menuItem" data-sym="MES">
                <span class="dot" style="background:#28E6A5"></span>
                <span class="selectText">MES • $5/pt</span>
              </div>
              <div class="menuItem" data-sym="MGC1">
                <span class="dot" style="background:#FFD34D"></span>
                <span class="selectText">MGC1! • $10/1.0</span>
              </div>
              <div class="menuItem" data-sym="SI1">
                <span class="dot" style="background:#FF4D6D"></span>
                <span class="selectText">SI1! • $5 per 0.01 (micro)</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="riskCard">
          <div class="label" id="riskLabel">$ RISK (PER TRADE)</div>

          <!-- SI1 toggle only -->
          <div class="toggleRow" id="silverToggleRow">
            <div class="toggleText" id="silverToggleText">STOP ➜ AUTO RISK</div>
            <label class="switch" aria-label="Silver mode toggle">
              <input type="checkbox" id="silverModeToggle" />
              <span class="track"></span>
              <span class="knob"></span>
            </label>
          </div>

          <input class="input" id="riskInput" inputmode="decimal" placeholder="e.g. 100" />
          <div class="chips" id="riskChips">
            <button class="chipBtn" type="button" data-risk="50">50</button>
            <button class="chipBtn" type="button" data-risk="80">80</button>
            <button class="chipBtn" type="button" data-risk="100">100</button>
            <button class="chipBtn" type="button" data-risk="120">120</button>
          </div>
        </div>

        <div class="card">
          <div class="label" id="stopLabel">STOP</div>
          <input class="input" id="stopInput" inputmode="decimal" placeholder="Enter stop" />
          <div class="chips" id="stopChips"></div>
        </div>

        <div class="card">
          <div class="label" id="tpLabel">TP</div>
          <input class="input" id="tpInput" inputmode="decimal" placeholder="Enter TP" />
          <div class="chips" id="tpChips"></div>
        </div>

      </div>

      <div class="outGrid">
        <div class="out">
          <div class="outTitle">CONTRACTS</div>
          <div class="outVal" id="outContracts">—</div>
        </div>
        <div class="out">
          <div class="outTitle">TOTAL RISK ($)</div>
          <div class="outVal" id="outRisk">$—</div>
        </div>
        <div class="out">
          <div class="outTitle">TP PROFIT ($)</div>
          <div class="outVal" id="outProfit">$—</div>
        </div>
        <div class="out">
          <div class="outTitle" id="unitTitle">$ / POINT</div>
          <div class="outVal" id="outUnit">$—</div>
        </div>
      </div>

      <div class="miniChips" id="recChips"></div>

      <div class="status" id="statusBox">
        <span class="statusDot" id="statusDot" style="background:var(--warn)"></span>
        <span id="statusText">Enter values to calculate.</span>
      </div>

    </div>

    <div class="bottomRow">
      <button class="btn" id="resetBtn" type="button">Reset Inputs</button>
    </div>

  </div>
</div>

<script>
  // =========================
  // CONFIG
  // =========================
  const SYMBOLS = {
    MNQ: {
      name: "MNQ",
      pill: "MNQ • $2/pt",
      color: "#28E6A5",
      mode: "normal",
      unitTitle: "$ / POINT (1 MICRO)",
      unitValue: 2,
      stopChips: [20,25,30,40],
      tpChips: [60,80,100],
      rec: [],
      formula: "Size = Risk ÷ (Stop × $/Point)"
    },
    MES: {
      name: "MES",
      pill: "MES • $5/pt",
      color: "#28E6A5",
      mode: "normal",
      unitTitle: "$ / POINT (1 MICRO)",
      unitValue: 5,
      stopChips: [5,8,10],
      tpChips: [10,12,20],
      rec: [],
      formula: "Size = Risk ÷ (Stop × $/Point)"
    },
    MGC1: {
      name: "MGC1!",
      pill: "MGC1! • $10/1.0",
      color: "#FFD34D",
      mode: "normal",
      unitTitle: "$ / 1.0 (1 MICRO)",
      unitValue: 10,
      stopChips: [1,1.5,2,2.5],
      tpChips: [3,4,5,6],
      rec: [],
      formula: "Size = Risk ÷ (Stop × $/Point)"
    },
    SI1: {
      name: "SI1!",
      // keep the math you already validated with screenshots:
      // micro silver journaling: $5 per 0.01 move (1 micro)
      pill: "SI1! • micro $5 / 0.01",
      color: "#FF4D6D",
      mode: "silver",
      per001: 5,
      step: 0.01,
      unitTitle: "$ PER 0.01 (1 MICRO)",
      stopChips: [0.02,0.03,0.04,0.05,0.10,0.20,0.63],
      tpChips: [0.06,0.10,0.12,0.50,1.00,2.02],
      rec: [],
      formula: "Micro Silver: Risk = (Stop ÷ 0.01) × $5 • Profit = (TP ÷ 0.01) × $5"
    }
  };

  // =========================
  // ELEMENTS
  // =========================
  const formulaText = document.getElementById("formulaText");

  const pillDot = document.getElementById("pillDot");
  const pillText = document.getElementById("pillText");

  const selectBtn = document.getElementById("selectBtn");
  const selectDot = document.getElementById("selectDot");
  const selectText = document.getElementById("selectText");
  const selectChev = document.getElementById("selectChev");
  const menu = document.getElementById("menu");

  const riskCard = document.getElementById("riskCard");
  const riskLabel = document.getElementById("riskLabel");
  const riskInput = document.getElementById("riskInput");
  const riskChips = document.getElementById("riskChips");

  const silverToggleRow = document.getElementById("silverToggleRow");
  const silverModeToggle = document.getElementById("silverModeToggle");
  const silverToggleText = document.getElementById("silverToggleText");

  const stopLabel = document.getElementById("stopLabel");
  const stopInput = document.getElementById("stopInput");
  const stopChips = document.getElementById("stopChips");

  const tpLabel = document.getElementById("tpLabel");
  const tpInput = document.getElementById("tpInput");
  const tpChips = document.getElementById("tpChips");

  const outContracts = document.getElementById("outContracts");
  const outRisk = document.getElementById("outRisk");
  const outProfit = document.getElementById("outProfit");
  const outUnit = document.getElementById("outUnit");
  const unitTitle = document.getElementById("unitTitle");

  const recChips = document.getElementById("recChips");

  const statusDot = document.getElementById("statusDot");
  const statusText = document.getElementById("statusText");

  const resetBtn = document.getElementById("resetBtn");

  // =========================
  // STATE
  // =========================
  let current = "MNQ";

  // =========================
  // HELPERS
  // =========================
  function toNum(v){
    if(v === "" || v == null) return NaN;
    const n = Number(String(v).replace(/,/g,"").trim());
    return Number.isFinite(n) ? n : NaN;
  }

  function money(n){
    if(!Number.isFinite(n)) return "—";
    const fixed = Math.round(n * 100) / 100;
    return fixed.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 2 });
  }

  function setStatusDot(type){
    if(type === "good"){ statusDot.style.background = "var(--good)"; }
    else if(type === "bad"){ statusDot.style.background = "var(--bad)"; }
    else { statusDot.style.background = "var(--warn)"; }
  }

  function setRiskTierStatus(riskVal){
    // Required tiers:
    // 50–500 => green
    // 500–1500 => yellow
    // >1500 => red
    if(!Number.isFinite(riskVal)){
      setStatusDot("warn");
      statusText.textContent = "Enter values to calculate.";
      return;
    }

    if(riskVal >= 50 && riskVal <= 500){
      setStatusDot("good");
      statusText.textContent = "Risk OK (50–500).";
      return;
    }
    if(riskVal > 500 && riskVal <= 1500){
      setStatusDot("warn");
      statusText.textContent = "High risk (500–1500).";
      return;
    }
    if(riskVal > 1500){
      setStatusDot("bad");
      statusText.textContent = "Too much risk (1500+).";
      return;
    }

    setStatusDot("warn");
    statusText.textContent = "Risk is under $50.";
  }

  function clearChips(el){ el.innerHTML = ""; }
  function addChip(el, label, onClick){
    const b = document.createElement("button");
    b.type = "button";
    b.className = "chipBtn";
    b.textContent = label;
    b.addEventListener("click", onClick);
    el.appendChild(b);
  }

  function closeMenu(){
    menu.classList.remove("open");
    selectChev.style.transform = "rotate(45deg)";
  }

  // =========================
  // UI UPDATE
  // =========================
  function applySymbol(sym){
    current = sym;
    const S = SYMBOLS[current];

    // IMPORTANT: reset inputs when changing symbol
    riskInput.value = "";
    stopInput.value = "";
    tpInput.value = "";

    // pill
    pillDot.style.background = S.color;
    selectDot.style.background = S.color;
    pillText.textContent = S.pill;
    selectText.textContent = S.name;

    // formula
    formulaText.textContent = S.formula;

    // unit title/value
    unitTitle.textContent = S.unitTitle;
    if(S.mode === "silver"){
      outUnit.textContent = `$${money(S.per001)}`;
    }else{
      outUnit.textContent = `$${money(S.unitValue)}`;
    }

    // risk behavior + SI toggle
    if(S.mode === "silver"){
      silverToggleRow.style.display = "flex";
      // default toggle OFF = stop -> auto risk (matches the left position)
      silverModeToggle.checked = false;
      silverToggleText.textContent = "STOP ➜ AUTO RISK";

      riskCard.style.opacity = "1";
      riskChips.style.display = "none"; // chips not needed for SI

      riskLabel.textContent = "$ RISK";
      riskInput.disabled = true; // in STOP mode we auto-fill risk

      stopLabel.textContent = "STOP (DISTANCE)";
      tpLabel.textContent = "TP (DISTANCE)";
      stopInput.placeholder = "e.g. 0.63";
      tpInput.placeholder = "e.g. 2.02";
    }else{
      silverToggleRow.style.display = "none";

      riskCard.style.opacity = "1";
      riskInput.disabled = false;
      riskLabel.textContent = "$ RISK (PER TRADE)";
      riskChips.style.display = "flex";

      stopLabel.textContent = "STOP";
      tpLabel.textContent = "TP";
      stopInput.placeholder = "Enter stop";
      tpInput.placeholder = "Enter TP";
    }

    // chips
    clearChips(stopChips);
    clearChips(tpChips);

    S.stopChips.forEach(v=>{
      addChip(stopChips, String(v), () => { stopInput.value = String(v); calc(); });
    });
    S.tpChips.forEach(v=>{
      addChip(tpChips, String(v), () => { tpInput.value = String(v); calc(); });
    });

    // recommendations (removed)
    recChips.innerHTML = "";

    // clean outputs
    outContracts.textContent = "—";
    outRisk.textContent = "$—";
    outProfit.textContent = "$—";

    setStatusDot("warn");
    statusText.textContent = "Enter values to calculate.";
    closeMenu();
    calc();
  }

  // =========================
  // CALCULATION
  // =========================
  function calc(){
    const S = SYMBOLS[current];
    const stop = toNum(stopInput.value);
    const tp = toNum(tpInput.value);

    // For normal symbols
    if(S.mode !== "silver"){
      const risk = toNum(riskInput.value);

      if(!Number.isFinite(risk) || !Number.isFinite(stop) || stop <= 0){
        outContracts.textContent = "—";
        outRisk.textContent = "$—";
        outProfit.textContent = "$—";
        setStatusDot("warn");
        statusText.textContent = "Enter Risk + Stop (and TP if you want profit).";
        return;
      }

      const perPoint = S.unitValue;
      let contracts = Math.floor(risk / (stop * perPoint));
      if(!Number.isFinite(contracts) || contracts < 0) contracts = 0;

      // cap by Lucid max 40 micros (you’re using micros)
      if(contracts > 40) contracts = 40;

      const totalRisk = contracts * stop * perPoint;
      const profit = (Number.isFinite(tp) && tp > 0) ? (tp * perPoint * contracts) : 0;

      outContracts.textContent = String(contracts);
      outRisk.textContent = `$${money(totalRisk)}`;
      outProfit.textContent = `$${money(profit)}`;

      if(contracts === 0){
        setStatusDot("bad");
        statusText.textContent = "Size is 0. Increase risk or reduce stop.";
        return;
      }

      // NEW risk tiers (50–500 green, 500–1500 yellow, 1500+ red)
      setRiskTierStatus(risk);
      return;
    }

    // =========================
    // SILVER (SI1!) — micro silver math
    // STOP mode (toggle OFF): user enters stop/tp, risk auto.
    // RISK mode (toggle ON): user enters risk, stop auto (tp stays manual).
    // =========================
    const contracts = 1;
    const per001 = S.per001; // $5 per 0.01
    const step = S.step;     // 0.01

    const riskMode = !!silverModeToggle.checked;

    if(riskMode){
      silverToggleText.textContent = "RISK ➜ AUTO STOP";
      riskInput.disabled = false;
      riskLabel.textContent = "$ RISK (ENTER)";

      const desiredRisk = toNum(riskInput.value);
      if(!Number.isFinite(desiredRisk) || desiredRisk <= 0){
        outContracts.textContent = "1";
        outRisk.textContent = "$—";
        outProfit.textContent = "$—";
        setStatusDot("warn");
        statusText.textContent = "Enter Risk, then Stop auto-fills.";
        return;
      }

      // Stop distance derived from risk:
      // risk = (stop / 0.01) * $5  => stop = (risk / 5) * 0.01
      const derivedStop = (desiredRisk / per001) * step;

      // Fill stop input (do not mess with TP)
      stopInput.value = (Math.round(derivedStop * 1000) / 1000).toString();

      const totalRisk = desiredRisk; // in risk mode, this is the intended risk
      const profit = (Number.isFinite(tp) && tp > 0) ? (tp / step) * per001 : 0;

      outContracts.textContent = "1";
      outRisk.textContent = `$${money(totalRisk)}`;
      outProfit.textContent = `$${money(profit)}`;

      setRiskTierStatus(totalRisk);
      return;
    }

    // STOP mode
    silverToggleText.textContent = "STOP ➜ AUTO RISK";
    riskInput.disabled = true;
    riskLabel.textContent = "$ RISK (AUTO)";

    if(!Number.isFinite(stop) || stop <= 0){
      outContracts.textContent = "1";
      outRisk.textContent = "$—";
      outProfit.textContent = "$—";
      setStatusDot("warn");
      statusText.textContent = "Enter Stop (and TP if you want profit).";
      return;
    }

    const totalRisk = (stop / step) * per001;
    const profit = (Number.isFinite(tp) && tp > 0) ? (tp / step) * per001 : 0;

    // show auto risk inside the risk box
    riskInput.value = money(totalRisk);

    outContracts.textContent = "1";
    outRisk.textContent = `$${money(totalRisk)}`;
    outProfit.textContent = `$${money(profit)}`;

    setRiskTierStatus(totalRisk);
  }

  // =========================
  // EVENTS
  // =========================
  // dropdown open/close
  selectBtn.addEventListener("click", () => {
    const open = menu.classList.toggle("open");
    selectChev.style.transform = open ? "rotate(-135deg)" : "rotate(45deg)";
  });

  // click outside to close
  document.addEventListener("click", (e) => {
    if(!e.target.closest(".selectWrap")) closeMenu();
  });

  // select item
  menu.querySelectorAll(".menuItem").forEach(item=>{
    item.addEventListener("click", () => applySymbol(item.dataset.sym));
  });

  // risk chips
  riskChips.querySelectorAll("[data-risk]").forEach(b=>{
    b.addEventListener("click", () => {
      if(riskInput.disabled) return;
      riskInput.value = b.dataset.risk;
      calc();
    });
  });

  // inputs
  [riskInput, stopInput, tpInput].forEach(inp=>{
    inp.addEventListener("input", calc);
  });

  // SI1 toggle
  silverModeToggle.addEventListener("change", () => {
    // clear fields when switching mode so it feels clean
    riskInput.value = "";
    stopInput.value = "";
    tpInput.value = "";
    calc();
  });

  // reset
  resetBtn.addEventListener("click", () => {
    riskInput.value = "";
    stopInput.value = "";
    tpInput.value = "";
    // reset SI toggle if on SI
    if(SYMBOLS[current].mode === "silver"){
      silverModeToggle.checked = false;
      silverToggleText.textContent = "STOP ➜ AUTO RISK";
      riskInput.disabled = true;
    }
    calc();
  });

  // init
  applySymbol("MNQ");
</script>

</body>
</html>
